import{_ as r,r as p,o as c,c as i,d as s,b as e,w as l,e as n,f as t}from"./app-0c468531.js";const d={},u=s("h1",{id:"nuxt-错误调试",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#nuxt-错误调试","aria-hidden":"true"},"#"),n(" Nuxt 错误调试")],-1),D={class:"table-of-contents"},h=t('<h2 id="_1-介绍" tabindex="-1"><a class="header-anchor" href="#_1-介绍" aria-hidden="true">#</a> 1. 介绍</h2><p>本系列不是调试指南，而且填坑指南，因为现阶段 Nuxt 3 错误极多，已经无法总结，所以就在此列举。</p><h2 id="_2-错误列表" tabindex="-1"><a class="header-anchor" href="#_2-错误列表" aria-hidden="true">#</a> 2. 错误列表</h2><h3 id="_2-1-快速触发导航导致-vue-渲染错误" tabindex="-1"><a class="header-anchor" href="#_2-1-快速触发导航导致-vue-渲染错误" aria-hidden="true">#</a> 2.1. 快速触发导航导致 Vue 渲染错误</h3>',4),_={href:"https://github.com/nuxt/nuxt/issues/13350",target:"_blank",rel:"noopener noreferrer"},y={href:"https://github.com/vuejs/core/issues/8105",target:"_blank",rel:"noopener noreferrer"},x=s("code",null,"<Suspense />",-1),v=s("code",null,"<Suspense />",-1),b=s("p",null,"临时解决方法：",-1),f=s("li",null,"禁用过渡动画",-1),C={href:"https://github.com/nuxt/nuxt/issues/13350#issuecomment-1543968330",target:"_blank",rel:"noopener noreferrer"},m=s("li",null,"监听全局错误然后强制刷新，参见下面的代码，体验很差",-1),g=t(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">meta</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">env</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">SSR</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// [Bug](https://github.com/nuxt/nuxt/issues/13350)</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 当出现渲染错误时，自动刷新页面，当此问题解决时删除此处代码</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addEventListener</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;error&#39;</span><span style="color:#D4D4D4;">, (</span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">message</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">includes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;insertBefore&#39;</span><span style="color:#D4D4D4;">)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">event</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">preventDefault</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">location</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">reload</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  })</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>还有一种方法，可以临时解决此问题，不过可能导致过渡行为间歇性失效，原因未知。</p><div class="language-vue" data-ext="vue"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">template</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">nuxt-layout</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#808080;">&lt;</span><span style="color:#F44747;">Transition</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;page&quot;</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">mode</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;out-in&quot;</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">div</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">:key</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;$route.fullPath&quot;</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">nuxt-page</span><span style="color:#D4D4D4;"> </span><span style="color:#808080;">/&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">div</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#808080;">&lt;/</span><span style="color:#F44747;">Transition</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">nuxt-layout</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">template</span><span style="color:#808080;">&gt;</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-2-类型异常" tabindex="-1"><a class="header-anchor" href="#_2-2-类型异常" aria-hidden="true">#</a> 2.2 类型异常</h3><p>总是跳出莫名其妙的异常，但是有时在 <code>node_modules</code> 中找不到异常的类型定义，导致无法解决。</p><p>可能是升级依赖时出现，也可能某个库依赖于运行时给出的类型定义，，也可能是 TypeScript 类型缓存，原因很多。</p><p>可能的解决方法：</p><ol><li>删除 <code>.nuxt</code> 目录，然后 <code>pnpm i</code></li><li>重启 VS Code</li></ol><h3 id="_2-3-部分依赖加载太慢或无法使用" tabindex="-1"><a class="header-anchor" href="#_2-3-部分依赖加载太慢或无法使用" aria-hidden="true">#</a> 2.3 部分依赖加载太慢或无法使用</h3><p>注意很多 <code>@nuxtjs/</code> 下的依赖都是仅适用于 Nuxt 2 的，但也有例外，而且有很多是 Alpha/Beta 版本，不稳定也不完整。</p><p>引入 <code>@nuxt/image</code> 在 Windows 下报错？暂未解决。</p><p>引入 <code>@nuxt/content</code> 时加载过慢，可能是在 GitHub 上下载内容，使用代理。</p><p>引入 <code>@nuxt/devtools</code> 时，路由跳转异常，许多功能无法使用。这个框架还是 Beta 阶段，作者每天直播打工开发，等等吧。</p><p>为什么我的 Pinia 无法持久化？Nuxt 文档写错了，应该去官方文档看看，安装这个 <code>@pinia-plugin-persistedstate/nuxt</code> 然后再看看文档。</p><h3 id="_2-4-如何用-nuxt-写一个-nuxt-文档" tabindex="-1"><a class="header-anchor" href="#_2-4-如何用-nuxt-写一个-nuxt-文档" aria-hidden="true">#</a> 2.4 如何用 Nuxt 写一个 Nuxt 文档</h3><p>Nuxt 的文档显然是 Nuxt 做的，但是官方 GitHub 里面没有一个配置文件是和这个文档有关的，只有格式化 MarkDown，而且这个 MarkDown 格式很怪。</p>`,16),E={href:"https://github.com/nuxt/nuxt/tree/main/docs",target:"_blank",rel:"noopener noreferrer"},k={href:"http://nuxt.com",target:"_blank",rel:"noopener noreferrer"},N={href:"https://docus.dev/",target:"_blank",rel:"noopener noreferrer"},w=t('<p>其实这个生态并不如 VuePress，很多插件配置很痛苦而且不完整，建议使用 VuePress/VitePress 写文档。</p><blockquote><p>不要把 VuePress 2 项目放在 Nuxt 项目下，编译报错，无法解决。应该是 Node 包导入机制的问题，这些包有许多冲突。</p></blockquote><h3 id="_2-5-如何使用-axios" tabindex="-1"><a class="header-anchor" href="#_2-5-如何使用-axios" aria-hidden="true">#</a> 2.5 如何使用 Axios</h3><p>不要用，Axios 在 Nuxt 3 中被废除了，Axios 有报告在 SSR 中出现内存泄漏，所以也别用了。新的 API 代替就行了。</p><h3 id="_2-6-如何调试-error-vue" tabindex="-1"><a class="header-anchor" href="#_2-6-如何调试-error-vue" aria-hidden="true">#</a> 2.6 如何调试 <code>error.vue</code></h3><p>放弃调试了，这个页面如果有 <code>[...slug].vue</code>，那么这个页面显示不了，如果没有，那么调试的时候显示源代码，有点混乱。</p><p>最简单的办法是故意写错一段代码，然后这个页面就能正常渲染了（即错误页面确实只在错误的时候被正确渲染，但如果错误页面都错误了 Nuxt 就真的不知道干什么了）。</p><h3 id="_2-7-远程调试无法使用" tabindex="-1"><a class="header-anchor" href="#_2-7-远程调试无法使用" aria-hidden="true">#</a> 2.7 远程调试无法使用</h3><p>在手机上连接不到调试服务器，显示连接 <code>ws://localhost:4000</code> 错误。</p><div class="hint-container tip"><p class="hint-container-title">手机调试</p><p>推荐手机使用 Kiwi Browser，这个浏览器可以使用 Chrome 插件，还可以使用原生的开发者工具。</p></div>',10),F={href:"https://github.com/nuxt/nuxt/issues/15417",target:"_blank",rel:"noopener noreferrer"},A=s("h3",{id:"_2-8-dev-过慢",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-8-dev-过慢","aria-hidden":"true"},"#"),n(" 2.8 dev 过慢")],-1),S=s("p",null,[n("更新后发现，Windows 下 "),s("code",null,"dev"),n(" 比 "),s("code",null,"build"),n(" 还慢，一直在执行 Nitro built，等了好几分钟才出来。")],-1),V={href:"https://github.com/nuxt/nuxt/issues/20990",target:"_blank",rel:"noopener noreferrer"},q=t('<p>初步猜测是 Nuxt 依赖的 Nitro 依赖的 Rollup 依赖的 Babel 导致的，暂未解决。</p><h2 id="_3-总结" tabindex="-1"><a class="header-anchor" href="#_3-总结" aria-hidden="true">#</a> 3. 总结</h2><ul><li>使用 <code>i<wbr>mport.meta.env.SSR</code> 判断是否为 SSR 环境</li><li>使用 <code>p<wbr>rocess.env.NODE_ENV === &#39;development&#39;</code> 判断是否为开发环境</li><li>使用 <code>p<wbr>rocess.env.NODE_ENV === &#39;production&#39;</code> 判断是否为生产环境</li><li>可以在 <code>nuxt.config.ts</code> 中使用 <code>runtimeConfig.public</code> 指定特殊变量 <ul><li>如 <code>buildTime: Date.now()</code> 表示打包时间</li><li>如 <code>version: require(&#39;./package.json&#39;).version</code> 表示版本号</li></ul></li></ul>',3);function B(P,R){const a=p("router-link"),o=p("ExternalLinkIcon");return c(),i("div",null,[u,s("nav",D,[s("ul",null,[s("li",null,[e(a,{to:"#_1-介绍"},{default:l(()=>[n("1. 介绍")]),_:1})]),s("li",null,[e(a,{to:"#_2-错误列表"},{default:l(()=>[n("2. 错误列表")]),_:1}),s("ul",null,[s("li",null,[e(a,{to:"#_2-1-快速触发导航导致-vue-渲染错误"},{default:l(()=>[n("2.1. 快速触发导航导致 Vue 渲染错误")]),_:1})]),s("li",null,[e(a,{to:"#_2-2-类型异常"},{default:l(()=>[n("2.2 类型异常")]),_:1})]),s("li",null,[e(a,{to:"#_2-3-部分依赖加载太慢或无法使用"},{default:l(()=>[n("2.3 部分依赖加载太慢或无法使用")]),_:1})]),s("li",null,[e(a,{to:"#_2-4-如何用-nuxt-写一个-nuxt-文档"},{default:l(()=>[n("2.4 如何用 Nuxt 写一个 Nuxt 文档")]),_:1})]),s("li",null,[e(a,{to:"#_2-5-如何使用-axios"},{default:l(()=>[n("2.5 如何使用 Axios")]),_:1})]),s("li",null,[e(a,{to:"#_2-6-如何调试-error-vue"},{default:l(()=>[n("2.6 如何调试 error.vue")]),_:1})]),s("li",null,[e(a,{to:"#_2-7-远程调试无法使用"},{default:l(()=>[n("2.7 远程调试无法使用")]),_:1})]),s("li",null,[e(a,{to:"#_2-8-dev-过慢"},{default:l(()=>[n("2.8 dev 过慢")]),_:1})])])]),s("li",null,[e(a,{to:"#_3-总结"},{default:l(()=>[n("3. 总结")]),_:1})])])]),h,s("p",null,[n("参见 "),s("a",_,[n("nuxt/nuxt#13350"),e(o)]),n("，此问题想了很久没有办法解决。")]),s("p",null,[n("此问题可以追溯到 "),s("a",y,[n("vue/core#8105"),e(o)]),n("，是 Vue 的实验性特征 "),x,n(" 导致的，而 Nuxt 的过渡动画是使用 "),v,n(" 实现的，所以无法解决。")]),b,s("ol",null,[f,s("li",null,[n("阻止过快触发导航，"),s("a",C,[n("这一点我已经提出来了"),e(o)]),n("，但是不能解决 100% 的问题，因此需要配合方法 3")]),m]),g,s("p",null,[n("因为官方还没把文档的源码放上去，那个 MarkDown 文件只是临时给你提交的。"),s("a",E,[n("官方说了"),e(o)]),n("：")]),s("blockquote",null,[s("p",null,[n("You can contribute directly on GitHub for now, we are planning to open source "),s("a",k,[n("nuxt.com"),e(o)]),n(" repo for everyone to contribute with ease very soon.")])]),s("p",null,[n("所以其实 Nuxt 的文档是 "),s("a",N,[n("Docus"),e(o)]),n(" 做的，你可以做一个差不多的 Nuxt 文档。")]),w,s("p",null,[n("无法解决，见 "),s("a",F,[n("nuxt/nuxt#15417"),e(o)]),n(" 有曲线救国的办法，具体见问题，太复杂了没有尝试。")]),A,S,s("p",null,[n("解决不了，见 "),s("a",V,[n("nuxt/nuxt#20990"),e(o)]),n("，以上所有方法均无效，回滚版本吧。")]),q])}const j=r(d,[["render",B],["__file","get-started.html.vue"]]);export{j as default};
