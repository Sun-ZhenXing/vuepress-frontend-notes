import{_ as u}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o as c,c as i,b as n,a as e,w as a,e as t,d as l}from"./app-BdnEjZx0.js";const r={},d=n("h1",{id:"nuxt-错误调试",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#nuxt-错误调试"},[n("span",null,"Nuxt 错误调试")])],-1),h={class:"table-of-contents"},k=l('<h2 id="1-介绍" tabindex="-1"><a class="header-anchor" href="#1-介绍"><span>1. 介绍</span></a></h2><p>本系列不是调试指南，而且填坑指南，因为现阶段 Nuxt 3 错误极多，已经无法总结，所以就在此列举。</p><h2 id="2-错误列表" tabindex="-1"><a class="header-anchor" href="#2-错误列表"><span>2. 错误列表</span></a></h2><h3 id="21-快速触发导航导致-vue-渲染错误" tabindex="-1"><a class="header-anchor" href="#21-快速触发导航导致-vue-渲染错误"><span>2.1. 快速触发导航导致 Vue 渲染错误</span></a></h3>',4),x={href:"https://github.com/nuxt/nuxt/issues/13350",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/vuejs/core/issues/8105",target:"_blank",rel:"noopener noreferrer"},g=n("code",null,"<Suspense />",-1),m=n("code",null,"<Suspense />",-1),_=n("p",null,"临时解决方法：",-1),f=n("li",null,"禁用过渡动画",-1),b={href:"https://github.com/nuxt/nuxt/issues/13350#issuecomment-1543968330",target:"_blank",rel:"noopener noreferrer"},N=n("li",null,"监听全局错误然后强制刷新，参见下面的代码，体验很差",-1),y=l(`<div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SSR</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// [Bug](https://github.com/nuxt/nuxt/issues/13350)</span>
  <span class="token comment">// 当出现渲染错误时，自动刷新页面，当此问题解决时删除此处代码</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;insertBefore&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>还有一种方法，可以临时解决此问题，不过可能导致过渡行为间歇性失效，原因未知。</p><div class="language-vue" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-layout</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>page<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>out-in<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$route.fullPath<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-page</span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Transition</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-layout</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="22-类型异常" tabindex="-1"><a class="header-anchor" href="#22-类型异常"><span>2.2 类型异常</span></a></h3><p>总是跳出莫名其妙的异常，但是有时在 <code>node_modules</code> 中找不到异常的类型定义，导致无法解决。</p><p>可能是升级依赖时出现，也可能某个库依赖于运行时给出的类型定义，，也可能是 TypeScript 类型缓存，原因很多。</p><p>可能的解决方法：</p><ol><li>删除 <code>.nuxt</code> 目录，然后 <code>pnpm i</code></li><li>重启 VS Code</li></ol><h3 id="23-部分依赖加载太慢或无法使用" tabindex="-1"><a class="header-anchor" href="#23-部分依赖加载太慢或无法使用"><span>2.3 部分依赖加载太慢或无法使用</span></a></h3><p>注意很多 <code>@nuxtjs/</code> 下的依赖都是仅适用于 Nuxt 2 的，但也有例外，而且有很多是 Alpha/Beta 版本，不稳定也不完整。</p><p>引入 <code>@nuxt/image</code> 在 Windows 下报错？暂未解决。</p><p>引入 <code>@nuxt/content</code> 时加载过慢，可能是在 GitHub 上下载内容，使用代理。</p><p>引入 <code>@nuxt/devtools</code> 时，路由跳转异常，许多功能无法使用。这个框架还是 Beta 阶段，作者每天直播打工开发，等等吧。</p><p>为什么我的 Pinia 无法持久化？Nuxt 文档写错了，应该去官方文档看看，安装这个 <code>@pinia-plugin-persistedstate/nuxt</code> 然后再看看文档。</p><h3 id="24-如何用-nuxt-写一个-nuxt-文档" tabindex="-1"><a class="header-anchor" href="#24-如何用-nuxt-写一个-nuxt-文档"><span>2.4 如何用 Nuxt 写一个 Nuxt 文档</span></a></h3><p>Nuxt 的文档显然是 Nuxt 做的，但是官方 GitHub 里面没有一个配置文件是和这个文档有关的，只有格式化 MarkDown，而且这个 MarkDown 格式很怪。</p>`,16),w={href:"https://github.com/nuxt/nuxt/tree/main/docs",target:"_blank",rel:"noopener noreferrer"},V={href:"http://nuxt.com",target:"_blank",rel:"noopener noreferrer"},S={href:"https://docus.dev/",target:"_blank",rel:"noopener noreferrer"},q=l('<p>其实这个生态并不如 VuePress，很多插件配置很痛苦而且不完整，建议使用 VuePress/VitePress 写文档。</p><blockquote><p>不要把 VuePress 2 项目放在 Nuxt 项目下，编译报错，无法解决。应该是 Node 包导入机制的问题，这些包有许多冲突。</p></blockquote><h3 id="25-如何使用-axios" tabindex="-1"><a class="header-anchor" href="#25-如何使用-axios"><span>2.5 如何使用 Axios</span></a></h3><p>不要用，Axios 在 Nuxt 3 中被废除了，Axios 有报告在 SSR 中出现内存泄漏，所以也别用了。新的 API 代替就行了。</p><h3 id="26-如何调试-errorvue" tabindex="-1"><a class="header-anchor" href="#26-如何调试-errorvue"><span>2.6 如何调试 <code>error.vue</code></span></a></h3><p>放弃调试了，这个页面如果有 <code>[...slug].vue</code>，那么这个页面显示不了，如果没有，那么调试的时候显示源代码，有点混乱。</p><p>最简单的办法是故意写错一段代码，然后这个页面就能正常渲染了（即错误页面确实只在错误的时候被正确渲染，但如果错误页面都错误了 Nuxt 就真的不知道干什么了）。</p><h3 id="27-远程调试无法使用" tabindex="-1"><a class="header-anchor" href="#27-远程调试无法使用"><span>2.7 远程调试无法使用</span></a></h3><p>在手机上连接不到调试服务器，显示连接 <code>ws://localhost:4000</code> 错误。</p><div class="hint-container tip"><p class="hint-container-title">手机调试</p><p>推荐手机使用 Kiwi Browser，这个浏览器可以使用 Chrome 插件，还可以使用原生的开发者工具。</p></div>',10),T={href:"https://github.com/nuxt/nuxt/issues/15417",target:"_blank",rel:"noopener noreferrer"},D=n("h3",{id:"28-dev-过慢",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#28-dev-过慢"},[n("span",null,"2.8 dev 过慢")])],-1),B=n("p",null,[t("更新后发现，Windows 下 "),n("code",null,"dev"),t(" 比 "),n("code",null,"build"),t(" 还慢，一直在执行 Nitro built，等了好几分钟才出来。")],-1),P={href:"https://github.com/nuxt/nuxt/issues/20990",target:"_blank",rel:"noopener noreferrer"},A=l('<p>初步猜测是 Nuxt 依赖的 Nitro 依赖的 Rollup 依赖的 Babel 导致的，暂未解决。</p><h2 id="3-总结" tabindex="-1"><a class="header-anchor" href="#3-总结"><span>3. 总结</span></a></h2><ul><li>使用 <code>import.meta.env.SSR</code> 判断是否为 SSR 环境</li><li>使用 <code>process.env.NODE_ENV === &#39;development&#39;</code> 判断是否为开发环境</li><li>使用 <code>process.env.NODE_ENV === &#39;production&#39;</code> 判断是否为生产环境</li><li>可以在 <code>nuxt.config.ts</code> 中使用 <code>runtimeConfig.public</code> 指定特殊变量 <ul><li>如 <code>buildTime: Date.now()</code> 表示打包时间</li><li>如 <code>version: require(&#39;./package.json&#39;).version</code> 表示版本号</li></ul></li></ul>',3);function E(C,R){const s=p("router-link"),o=p("ExternalLinkIcon");return c(),i("div",null,[d,n("nav",h,[n("ul",null,[n("li",null,[e(s,{to:"#1-介绍"},{default:a(()=>[t("1. 介绍")]),_:1})]),n("li",null,[e(s,{to:"#2-错误列表"},{default:a(()=>[t("2. 错误列表")]),_:1}),n("ul",null,[n("li",null,[e(s,{to:"#21-快速触发导航导致-vue-渲染错误"},{default:a(()=>[t("2.1. 快速触发导航导致 Vue 渲染错误")]),_:1})]),n("li",null,[e(s,{to:"#22-类型异常"},{default:a(()=>[t("2.2 类型异常")]),_:1})]),n("li",null,[e(s,{to:"#23-部分依赖加载太慢或无法使用"},{default:a(()=>[t("2.3 部分依赖加载太慢或无法使用")]),_:1})]),n("li",null,[e(s,{to:"#24-如何用-nuxt-写一个-nuxt-文档"},{default:a(()=>[t("2.4 如何用 Nuxt 写一个 Nuxt 文档")]),_:1})]),n("li",null,[e(s,{to:"#25-如何使用-axios"},{default:a(()=>[t("2.5 如何使用 Axios")]),_:1})]),n("li",null,[e(s,{to:"#26-如何调试-errorvue"},{default:a(()=>[t("2.6 如何调试 error.vue")]),_:1})]),n("li",null,[e(s,{to:"#27-远程调试无法使用"},{default:a(()=>[t("2.7 远程调试无法使用")]),_:1})]),n("li",null,[e(s,{to:"#28-dev-过慢"},{default:a(()=>[t("2.8 dev 过慢")]),_:1})])])]),n("li",null,[e(s,{to:"#3-总结"},{default:a(()=>[t("3. 总结")]),_:1})])])]),k,n("p",null,[t("参见 "),n("a",x,[t("nuxt/nuxt#13350"),e(o)]),t("，此问题想了很久没有办法解决。")]),n("p",null,[t("此问题可以追溯到 "),n("a",v,[t("vue/core#8105"),e(o)]),t("，是 Vue 的实验性特征 "),g,t(" 导致的，而 Nuxt 的过渡动画是使用 "),m,t(" 实现的，所以无法解决。")]),_,n("ol",null,[f,n("li",null,[t("阻止过快触发导航，"),n("a",b,[t("这一点我已经提出来了"),e(o)]),t("，但是不能解决 100% 的问题，因此需要配合方法 3")]),N]),y,n("p",null,[t("因为官方还没把文档的源码放上去，那个 MarkDown 文件只是临时给你提交的。"),n("a",w,[t("官方说了"),e(o)]),t("：")]),n("blockquote",null,[n("p",null,[t("You can contribute directly on GitHub for now, we are planning to open source "),n("a",V,[t("nuxt.com"),e(o)]),t(" repo for everyone to contribute with ease very soon.")])]),n("p",null,[t("所以其实 Nuxt 的文档是 "),n("a",S,[t("Docus"),e(o)]),t(" 做的，你可以做一个差不多的 Nuxt 文档。")]),q,n("p",null,[t("无法解决，见 "),n("a",T,[t("nuxt/nuxt#15417"),e(o)]),t(" 有曲线救国的办法，具体见问题，太复杂了没有尝试。")]),D,B,n("p",null,[t("解决不了，见 "),n("a",P,[t("nuxt/nuxt#20990"),e(o)]),t("，以上所有方法均无效，回滚版本吧。")]),A])}const Z=u(r,[["render",E],["__file","get-started.html.vue"]]),z=JSON.parse('{"path":"/notebook/other/nuxt-errors/get-started.html","title":"Nuxt 错误调试","lang":"zh-CN","frontmatter":{"description":"Nuxt 错误调试 1. 介绍 本系列不是调试指南，而且填坑指南，因为现阶段 Nuxt 3 错误极多，已经无法总结，所以就在此列举。 2. 错误列表 2.1. 快速触发导航导致 Vue 渲染错误 参见 nuxt/nuxt#13350，此问题想了很久没有办法解决。 此问题可以追溯到 vue/core#8105，是 Vue 的实验性特征 <Suspense...","head":[["meta",{"property":"og:url","content":"https://blog.alexsun.top/vuepress-frontend-notes/vuepress-frontend-notes/notebook/other/nuxt-errors/get-started.html"}],["meta",{"property":"og:site_name","content":"前端笔记"}],["meta",{"property":"og:title","content":"Nuxt 错误调试"}],["meta",{"property":"og:description","content":"Nuxt 错误调试 1. 介绍 本系列不是调试指南，而且填坑指南，因为现阶段 Nuxt 3 错误极多，已经无法总结，所以就在此列举。 2. 错误列表 2.1. 快速触发导航导致 Vue 渲染错误 参见 nuxt/nuxt#13350，此问题想了很久没有办法解决。 此问题可以追溯到 vue/core#8105，是 Vue 的实验性特征 <Suspense..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-04T11:44:04.000Z"}],["meta",{"property":"article:author","content":"鸭梨"}],["meta",{"property":"article:modified_time","content":"2024-05-04T11:44:04.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Nuxt 错误调试\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-04T11:44:04.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"鸭梨\\",\\"url\\":\\"https://blog.alexsun.top/\\"}]}"]]},"headers":[{"level":2,"title":"1. 介绍","slug":"1-介绍","link":"#1-介绍","children":[]},{"level":2,"title":"2. 错误列表","slug":"2-错误列表","link":"#2-错误列表","children":[{"level":3,"title":"2.1. 快速触发导航导致 Vue 渲染错误","slug":"21-快速触发导航导致-vue-渲染错误","link":"#21-快速触发导航导致-vue-渲染错误","children":[]},{"level":3,"title":"2.2 类型异常","slug":"22-类型异常","link":"#22-类型异常","children":[]},{"level":3,"title":"2.3 部分依赖加载太慢或无法使用","slug":"23-部分依赖加载太慢或无法使用","link":"#23-部分依赖加载太慢或无法使用","children":[]},{"level":3,"title":"2.4 如何用 Nuxt 写一个 Nuxt 文档","slug":"24-如何用-nuxt-写一个-nuxt-文档","link":"#24-如何用-nuxt-写一个-nuxt-文档","children":[]},{"level":3,"title":"2.5 如何使用 Axios","slug":"25-如何使用-axios","link":"#25-如何使用-axios","children":[]},{"level":3,"title":"2.6 如何调试 error.vue","slug":"26-如何调试-errorvue","link":"#26-如何调试-errorvue","children":[]},{"level":3,"title":"2.7 远程调试无法使用","slug":"27-远程调试无法使用","link":"#27-远程调试无法使用","children":[]},{"level":3,"title":"2.8 dev 过慢","slug":"28-dev-过慢","link":"#28-dev-过慢","children":[]}]},{"level":2,"title":"3. 总结","slug":"3-总结","link":"#3-总结","children":[]}],"git":{"createdTime":1684835340000,"updatedTime":1714823044000,"contributors":[{"name":"Sun-ZhenXing","email":"1006925066@qq.com","commits":1}]},"readingTime":{"minutes":4.05,"words":1214},"filePathRelative":"notebook/other/nuxt-errors/get-started.md","localizedDate":"2023年5月23日","autoDesc":true}');export{Z as comp,z as data};
