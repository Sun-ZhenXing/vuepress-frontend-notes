import{_ as o,r as e,o as p,c as t,b as a,d as s,a as l,e as c}from"./app-rPvAhQef.js";const r={},D=a("h1",{id:"tensorflow-lite-入门示例",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#tensorflow-lite-入门示例","aria-hidden":"true"},"#"),s(" TensorFlow Lite 入门示例")],-1),i=a("h2",{id:"1-android-识别鲜花类型",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#1-android-识别鲜花类型","aria-hidden":"true"},"#"),s(" 1. Android 识别鲜花类型")],-1),d={href:"https://codelabs.developers.google.com/codelabs/recognize-flowers-with-tensorflow-on-android/",target:"_blank",rel:"noopener noreferrer"},y={href:"https://colab.research.google.com/drive/1sqBewUnvdATOO-yblj55EBFb2sM24XHR",target:"_blank",rel:"noopener noreferrer"},C=a("code",null,"FlowerModel.tflite",-1),h=c(`<p>我们克隆官方的项目，然后用 Android Studio 打开。</p><div class="language-bash" data-ext="sh"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">git</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">clone</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">https://github.com/hoitab/TFLClassify.git</span></span>
<span class="line"></span></code></pre></div><p>将这个应用运行到手机上，应该能看到教程第四步的效果，每个值都是随机的。</p><p>按照第五步的说明，将 <code>FlowerModel.tflite</code> 加入项目。然后是第六步，查找 TODO List，将每一步的代码复制到指定位置。</p><p>记得注释下面的代码：</p><div class="language-kotlin" data-ext="kt"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">// START - Placeholder code at the start of the codelab. Comment this block of code out.</span></span>
<span class="line"><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (i </span><span style="color:#569CD6;">in</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">..MAX_RESULT_DISPLAY-</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    items.</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">Recognition</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Fake label </span><span style="color:#9CDCFE;">$i</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">, Random.</span><span style="color:#DCDCAA;">nextFloat</span><span style="color:#D4D4D4;">()))</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"><span style="color:#6A9955;">// END - Placeholder code at the start of the codelab. Comment this block of code out.</span></span>
<span class="line"></span></code></pre></div><p>然后可以看到教程第七步的效果。下面是使用 GPU 推理，加入依赖：</p><div class="language-properties" data-ext="properties"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">implementation </span><span style="color:#CE9178;">&#39;org.tensorflow:tensorflow-lite-gpu:2.3.0&#39;</span></span>
<span class="line"></span></code></pre></div><p>然后 Sync，接着修改 TODO 6 的代码为下面的代码即可，重新运行。</p><div class="language-kotlin" data-ext="kt"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> flowerModel: </span><span style="color:#4EC9B0;">FlowerModel</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">by</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">lazy</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// Initialize the Flower Model</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// TODO 6. Optional GPU acceleration</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> compatList = </span><span style="color:#DCDCAA;">CompatibilityList</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> options = </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;">(compatList.isDelegateSupportedOnThisDevice) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        Log.</span><span style="color:#DCDCAA;">d</span><span style="color:#D4D4D4;">(TAG, </span><span style="color:#CE9178;">&quot;This device is GPU Compatible &quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">        Model.Options.</span><span style="color:#DCDCAA;">Builder</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">setDevice</span><span style="color:#D4D4D4;">(Model.Device.GPU).</span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        Log.</span><span style="color:#DCDCAA;">d</span><span style="color:#D4D4D4;">(TAG, </span><span style="color:#CE9178;">&quot;This device is GPU Incompatible &quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">        Model.Options.</span><span style="color:#DCDCAA;">Builder</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">setNumThreads</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">).</span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    FlowerModel.</span><span style="color:#DCDCAA;">newInstance</span><span style="color:#D4D4D4;">(ctx, options)</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre></div><p>如果此时正在使用 GPU 推理，控制台能看到日志。如果出现下面的日志</p><div class="language-console" data-ext="console"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">D/TFL Classify: This device is GPU Incompatible</span></span>
<span class="line"></span></code></pre></div><p>则是 GPU 不兼容，可能是手机的兼容性或版本的兼容性不足。</p>`,13);function A(u,b){const n=e("ExternalLinkIcon");return p(),t("div",null,[D,i,a("p",null,[s("我们可以从 "),a("a",d,[s("官方示例"),l(n)]),s(" 学习最基本的使用方法。")]),a("p",null,[s("我们为了得到模型，需要在 "),a("a",y,[s("Colab"),l(n)]),s(" 上训练一个分类模型。然后下载此模型保存为 "),C,s(" 以备使用。")]),h])}const g=o(r,[["render",A],["__file","get-started.html.vue"]]);export{g as default};
