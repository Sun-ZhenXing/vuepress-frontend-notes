import{_ as r}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o as i,c as d,b as n,a as e,w as a,e as s,d as t}from"./app-FEcl1joV.js";const y={},D=n("h1",{id:"tampermonkey-参考",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#tampermonkey-参考"},[n("span",null,"Tampermonkey 参考")])],-1),u={class:"table-of-contents"},h={class:"hint-container warning"},m=n("p",{class:"hint-container-title"},"官方文档",-1),g={href:"https://www.tampermonkey.net/documentation.php",target:"_blank",rel:"noopener noreferrer"},_=t(`<h2 id="1-头信息" tabindex="-1"><a class="header-anchor" href="#1-头信息"><span>1. 头信息</span></a></h2><h3 id="name" tabindex="-1"><a class="header-anchor" href="#name"><span>@name</span></a></h3><p>脚本名称，可以通过后缀实现国际化。</p><div class="language-javascript" data-ext="js" data-title="js"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">// @name    A test</span></span>
<span class="line"><span style="color:#6A9955;">// @name:de Ein Test</span></span>
<span class="line"></span></code></pre></div><h3 id="namespace" tabindex="-1"><a class="header-anchor" href="#namespace"><span>@namespace</span></a></h3><p>命名空间，用于区分不同的脚本。</p><h3 id="copyright" tabindex="-1"><a class="header-anchor" href="#copyright"><span>@copyright</span></a></h3><p>版权声明，显示在脚本编辑器页眉的脚本名称下方。</p><h3 id="version" tabindex="-1"><a class="header-anchor" href="#version"><span>@version</span></a></h3><p>脚本版本号，用于更新检测，每次更新必须增加，并且使用语义化的版本号。</p><h3 id="description" tabindex="-1"><a class="header-anchor" href="#description"><span>@description</span></a></h3><p>脚本描述，可以通过后缀实现国际化。</p><h3 id="icon" tabindex="-1"><a class="header-anchor" href="#icon"><span>@icon</span></a></h3><p>低分辨率的脚本图标。也可以使用 <code>@iconURL</code>、<code>@defaulticon</code>。</p><h3 id="icon64" tabindex="-1"><a class="header-anchor" href="#icon64"><span>@icon64</span></a></h3><p>该脚本图标的像素为 64x64。如果给定了此标签，但未给定 <code>@icon</code>，则 <code>@icon</code> 图像将在选项页面的某些地方按比例缩放。</p><h3 id="grant" tabindex="-1"><a class="header-anchor" href="#grant"><span>@grant</span></a></h3><p><code>@grant</code> 用于授权 <code>GM_*</code> 和 <code>GM.*</code> 函数，还包括 <code>unsafeWindow</code> 对象和其他一些功能比较强的 <code>window</code> 函数。</p><div class="language-javascript" data-ext="js" data-title="js"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">// @grant GM_setValue</span></span>
<span class="line"><span style="color:#6A9955;">// @grant GM_getValue</span></span>
<span class="line"><span style="color:#6A9955;">// @grant GM.setValue</span></span>
<span class="line"><span style="color:#6A9955;">// @grant GM.getValue</span></span>
<span class="line"><span style="color:#6A9955;">// @grant GM_setClipboard</span></span>
<span class="line"><span style="color:#6A9955;">// @grant unsafeWindow</span></span>
<span class="line"><span style="color:#6A9955;">// @grant window.close</span></span>
<span class="line"><span style="color:#6A9955;">// @grant window.focus</span></span>
<span class="line"><span style="color:#6A9955;">// @grant window.onurlchange</span></span>
<span class="line"></span></code></pre></div><p>由于关闭和聚焦标签页是比较强的功能，因此也需要在 <code>@grant</code> 语句中添加这项功能。如果 <code>@grant</code> 后跟的是 <code>none</code>，则沙盒将被禁用。在这种模式下，<code>GM_*</code> 功能不可用，但 <code>GM_info</code> 仍然可用。</p><div class="language-javascript" data-ext="js" data-title="js"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">// @grant none</span></span>
<span class="line"></span></code></pre></div><p>如果没有给出 <code>@grant</code> 标记，则假定列表为空。但这与使用 <code>@grant none</code> 不同。</p><h3 id="author" tabindex="-1"><a class="header-anchor" href="#author"><span>@author</span></a></h3><p>脚本作者。</p><h2 id="2-api-接口" tabindex="-1"><a class="header-anchor" href="#2-api-接口"><span>2. API 接口</span></a></h2><h3 id="unsafewindow" tabindex="-1"><a class="header-anchor" href="#unsafewindow"><span>unsafeWindow</span></a></h3>`,26),C=n("code",null,"unsafeWindow: Window & typeof globalThis",-1),f=t(`<p><code>unsafeWindow</code> 对象提供了对 Tampermonkey 运行页面的 <code>window</code> 对象的访问权限，而不是 Tampermonkey 扩展的窗口对象。这在某些情况下非常有用，例如当用户脚本需要访问页面上定义的 JavaScript 库或变量时。</p><h3 id="子资源整合" tabindex="-1"><a class="header-anchor" href="#子资源整合"><span>子资源整合</span></a></h3><p>子资源整合（Subresource Integrity，SRI）是一项安全功能，可让用户脚本开发人员确保其用户脚本中包含的外部资源（如 JavaScript 库和 CSS 文件）未被篡改或修改。具体方法是生成资源的加密哈希值，并将其包含在 <code>@require</code> 和 <code>@resource</code> 标记中。安装用户脚本时，Tampermonkey 会计算资源的哈希值，并与包含的哈希值进行比较。如果两个哈希值不匹配，Tampermonkey 将拒绝加载资源，防止攻击者向用户脚本中注入恶意代码。</p><p><code>@resource</code> 和 <code>@require</code> 标记的 URL 中的哈希标记的使用方法如下。</p><div class="language-javascript" data-ext="js" data-title="js"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">// @resource SRIsecured1 http://example.com/favicon1.ico#md5=ad34bb...</span></span>
<span class="line"><span style="color:#6A9955;">// @resource SRIsecured2 http://example.com/favicon2.ico#md5=ac3434...,sha256=23fd34...</span></span>
<span class="line"><span style="color:#6A9955;">// @require              https://code.jquery.com/jquery-2.1.1.min.js#md5=45eef...</span></span>
<span class="line"><span style="color:#6A9955;">// @require              https://code.jquery.com/jquery-2.1.2.min.js#md5-ac56d...,sha256-6e789...</span></span>
<span class="line"><span style="color:#6A9955;">// @require              https://code.jquery.com/jquery-3.6.0.min.js#sha256-/xUj+3OJU...ogEvDej/m4=</span></span>
<span class="line"></span></code></pre></div><p>Tampermonkey 本身支持 SHA-256 和 MD5 哈希值，其他所有哈希值（SHA-1、SHA-384 和 SHA-512）都依赖于 <code>window.crypto</code>。</p><p>如果给出多个哈希值（用逗号或分号分隔），Tampermonkey 将使用当前支持的最后一个哈希值。所有哈希值都需要以十六进制或 Base64 格式编码。</p><h3 id="gm_addelement" tabindex="-1"><a class="header-anchor" href="#gm_addelement"><span>GM_addElement</span></a></h3><div class="hint-container warning"><p class="hint-container-title">实验性</p><p>此功能是实验性的，可能会在未来的版本中更改。</p></div>`,9),E=n("code",null,"GM_addElement(tag_name: string, attributes: ...): HTMLElement",-1),k=n("code",null,"GM_addElement(parent_node: ..., tag_name: string, attributes: ...): HTMLElement",-1),v=t(`<div class="language-javascript" data-ext="js" data-title="js"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">GM_addElement</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;script&#39;</span><span style="color:#D4D4D4;">, {</span></span>
<span class="line"><span style="color:#9CDCFE;">  textContent:</span><span style="color:#CE9178;"> &#39;window.foo = &quot;bar&quot;&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA;">GM_addElement</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;script&#39;</span><span style="color:#D4D4D4;">, {</span></span>
<span class="line"><span style="color:#9CDCFE;">  src:</span><span style="color:#CE9178;"> &#39;https://example.com/script.js&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  type:</span><span style="color:#CE9178;"> &#39;text/javascript&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA;">GM_addElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getElementsByTagName</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;div&#39;</span><span style="color:#D4D4D4;">)[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">], </span><span style="color:#CE9178;">&#39;img&#39;</span><span style="color:#D4D4D4;">, {</span></span>
<span class="line"><span style="color:#9CDCFE;">  src:</span><span style="color:#CE9178;"> &#39;https://example.com/image.png&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA;">GM_addElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">shadowDOM</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;style&#39;</span><span style="color:#D4D4D4;">, {</span></span>
<span class="line"><span style="color:#9CDCFE;">  textContent:</span><span style="color:#CE9178;"> &#39;div { color: black; }&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span>
<span class="line"></span></code></pre></div><h3 id="gm_addstyle" tabindex="-1"><a class="header-anchor" href="#gm_addstyle"><span>GM_addStyle</span></a></h3>`,2),x=n("code",null,"GM_addStyle(css: string): HTMLStyleElement",-1),b=t(`<p>将给定的样式添加到文档中，并返回注入的样式元素。</p><div class="language-javascript" data-ext="js" data-title="js"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">GM_addStyle</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">\`</span></span>
<span class="line"><span style="color:#CE9178;"> body {</span></span>
<span class="line"><span style="color:#CE9178;">    background-color: orange;</span></span>
<span class="line"><span style="color:#CE9178;">  }</span></span>
<span class="line"><span style="color:#CE9178;">\`</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="gm_download" tabindex="-1"><a class="header-anchor" href="#gm_download"><span>GM_download</span></a></h3>`,3),w=n("code",null,"GM_download(options: DownloadOptions): { abort(): boolean }",-1),A=n("code",null,"GM_download(url: string, name?: string): { abort(): boolean }",-1),M=t(`<p>下载文件。</p><div class="language-javascript" data-ext="js" data-title="js"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA;">GM_download</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;http://example.com/file.txt&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;file.txt&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> download</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">GM_download</span><span style="color:#D4D4D4;">({</span></span>
<span class="line"><span style="color:#9CDCFE;">  url:</span><span style="color:#CE9178;"> &quot;http://example.com/file.txt&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  name:</span><span style="color:#CE9178;"> &quot;file.txt&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  saveAs:</span><span style="color:#569CD6;"> true</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">// 5 秒后取消下载</span></span>
<span class="line"><span style="color:#9CDCFE;">window</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setTimeout</span><span style="color:#D4D4D4;">(() </span><span style="color:#569CD6;">=&gt;</span><span style="color:#9CDCFE;"> download</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">abort</span><span style="color:#D4D4D4;">(), </span><span style="color:#B5CEA8;">5000</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="gm_getresourcetext" tabindex="-1"><a class="header-anchor" href="#gm_getresourcetext"><span>GM_getResourceText</span></a></h3><p>允许用户脚本访问通过 <code>@resource</code> 包含在用户脚本中的资源（如 JavaScript 或 CSS 文件）的文本。</p><p>该函数接收一个参数，即要检索的资源的名称。它会以字符串形式返回资源文本。</p><p>下面是一个如何使用该函数的示例：</p><div class="language-javascript" data-ext="js" data-title="js"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> scriptText</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">GM_getResourceText</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;myscript.js&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#569CD6;">const</span><span style="color:#4FC1FF;"> script</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createElement</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;script&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#9CDCFE;">script</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">textContent</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">scriptText</span></span>
<span class="line"><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">body</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">appendChild</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">script</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="gm_info" tabindex="-1"><a class="header-anchor" href="#gm_info"><span>GM_info</span></a></h3><p>获取有关脚本和 TM 的一些信息。对象可能是这样的。</p>`,9);function T(j,G){const l=p("router-link"),c=p("ExternalLinkIcon"),o=p("Badge");return i(),d("div",null,[D,n("nav",u,[n("ul",null,[n("li",null,[e(l,{to:"#1-头信息"},{default:a(()=>[s("1. 头信息")]),_:1}),n("ul",null,[n("li",null,[e(l,{to:"#name"},{default:a(()=>[s("@name")]),_:1})]),n("li",null,[e(l,{to:"#namespace"},{default:a(()=>[s("@namespace")]),_:1})]),n("li",null,[e(l,{to:"#copyright"},{default:a(()=>[s("@copyright")]),_:1})]),n("li",null,[e(l,{to:"#version"},{default:a(()=>[s("@version")]),_:1})]),n("li",null,[e(l,{to:"#description"},{default:a(()=>[s("@description")]),_:1})]),n("li",null,[e(l,{to:"#icon"},{default:a(()=>[s("@icon")]),_:1})]),n("li",null,[e(l,{to:"#icon64"},{default:a(()=>[s("@icon64")]),_:1})]),n("li",null,[e(l,{to:"#grant"},{default:a(()=>[s("@grant")]),_:1})]),n("li",null,[e(l,{to:"#author"},{default:a(()=>[s("@author")]),_:1})])])]),n("li",null,[e(l,{to:"#2-api-接口"},{default:a(()=>[s("2. API 接口")]),_:1}),n("ul",null,[n("li",null,[e(l,{to:"#unsafewindow"},{default:a(()=>[s("unsafeWindow")]),_:1})]),n("li",null,[e(l,{to:"#子资源整合"},{default:a(()=>[s("子资源整合")]),_:1})]),n("li",null,[e(l,{to:"#gm_addelement"},{default:a(()=>[s("GM_addElement")]),_:1})]),n("li",null,[e(l,{to:"#gm_addstyle"},{default:a(()=>[s("GM_addStyle")]),_:1})]),n("li",null,[e(l,{to:"#gm_download"},{default:a(()=>[s("GM_download")]),_:1})]),n("li",null,[e(l,{to:"#gm_getresourcetext"},{default:a(()=>[s("GM_getResourceText")]),_:1})]),n("li",null,[e(l,{to:"#gm_info"},{default:a(()=>[s("GM_info")]),_:1})])])])])]),n("div",h,[m,n("p",null,[s("文本翻译并修改自 "),n("a",g,[s("官方文档"),e(c)]),s("，请以官方文档为准。")])]),_,n("p",null,[e(o,{style:{"user-select":"none"},type:"warning"},{default:a(()=>[s("TS")]),_:1}),s(),C]),f,n("p",null,[e(o,{style:{"user-select":"none"},type:"warning"},{default:a(()=>[s("TS")]),_:1}),s(),E]),n("p",null,[e(o,{style:{"user-select":"none"},type:"warning"},{default:a(()=>[s("TS")]),_:1}),s(),k]),v,n("p",null,[e(o,{style:{"user-select":"none"},type:"warning"},{default:a(()=>[s("TS")]),_:1}),s(),x]),b,n("p",null,[e(o,{style:{"user-select":"none"},type:"warning"},{default:a(()=>[s("TS")]),_:1}),s(),w]),n("p",null,[e(o,{style:{"user-select":"none"},type:"warning"},{default:a(()=>[s("TS")]),_:1}),s(),A]),M])}const q=r(y,[["render",T],["__file","reference.html.vue"]]),R=JSON.parse('{"path":"/notebook/library/tampermonkey/reference.html","title":"Tampermonkey 参考","lang":"zh-CN","frontmatter":{"date":"2023-11-14T22:00:00.000Z","description":"Tampermonkey 参考 官方文档 文本翻译并修改自 官方文档，请以官方文档为准。 1. 头信息 @name 脚本名称，可以通过后缀实现国际化。 @namespace 命名空间，用于区分不同的脚本。 @copyright 版权声明，显示在脚本编辑器页眉的脚本名称下方。 @version 脚本版本号，用于更新检测，每次更新必须增加，并且使用语义化的...","head":[["meta",{"property":"og:url","content":"https://blog.alexsun.top/vuepress-frontend-notes/vuepress-frontend-notes/notebook/library/tampermonkey/reference.html"}],["meta",{"property":"og:site_name","content":"前端笔记"}],["meta",{"property":"og:title","content":"Tampermonkey 参考"}],["meta",{"property":"og:description","content":"Tampermonkey 参考 官方文档 文本翻译并修改自 官方文档，请以官方文档为准。 1. 头信息 @name 脚本名称，可以通过后缀实现国际化。 @namespace 命名空间，用于区分不同的脚本。 @copyright 版权声明，显示在脚本编辑器页眉的脚本名称下方。 @version 脚本版本号，用于更新检测，每次更新必须增加，并且使用语义化的..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-05T01:44:53.000Z"}],["meta",{"property":"article:author","content":"鸭梨"}],["meta",{"property":"article:published_time","content":"2023-11-14T22:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-05-05T01:44:53.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Tampermonkey 参考\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-11-14T22:00:00.000Z\\",\\"dateModified\\":\\"2024-05-05T01:44:53.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"鸭梨\\",\\"url\\":\\"https://blog.alexsun.top/\\"}]}"]]},"headers":[{"level":2,"title":"1. 头信息","slug":"1-头信息","link":"#1-头信息","children":[{"level":3,"title":"@name","slug":"name","link":"#name","children":[]},{"level":3,"title":"@namespace","slug":"namespace","link":"#namespace","children":[]},{"level":3,"title":"@copyright","slug":"copyright","link":"#copyright","children":[]},{"level":3,"title":"@version","slug":"version","link":"#version","children":[]},{"level":3,"title":"@description","slug":"description","link":"#description","children":[]},{"level":3,"title":"@icon","slug":"icon","link":"#icon","children":[]},{"level":3,"title":"@icon64","slug":"icon64","link":"#icon64","children":[]},{"level":3,"title":"@grant","slug":"grant","link":"#grant","children":[]},{"level":3,"title":"@author","slug":"author","link":"#author","children":[]}]},{"level":2,"title":"2. API 接口","slug":"2-api-接口","link":"#2-api-接口","children":[{"level":3,"title":"unsafeWindow","slug":"unsafewindow","link":"#unsafewindow","children":[]},{"level":3,"title":"子资源整合","slug":"子资源整合","link":"#子资源整合","children":[]},{"level":3,"title":"GM_addElement","slug":"gm_addelement","link":"#gm_addelement","children":[]},{"level":3,"title":"GM_addStyle","slug":"gm_addstyle","link":"#gm_addstyle","children":[]},{"level":3,"title":"GM_download","slug":"gm_download","link":"#gm_download","children":[]},{"level":3,"title":"GM_getResourceText","slug":"gm_getresourcetext","link":"#gm_getresourcetext","children":[]},{"level":3,"title":"GM_info","slug":"gm_info","link":"#gm_info","children":[]}]}],"git":{"createdTime":1700303763000,"updatedTime":1714873493000,"contributors":[{"name":"Sun-ZhenXing","email":"1006925066@qq.com","commits":1}]},"readingTime":{"minutes":3.37,"words":1010},"filePathRelative":"notebook/library/tampermonkey/reference.md","localizedDate":"2023年11月14日","autoDesc":true}');export{q as comp,R as data};
