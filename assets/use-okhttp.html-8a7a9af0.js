import{_ as e,r as o,o as D,c as t,d as s,b as l,w as p,e as a,f as r}from"./app-6e2c49c0.js";const c={},i=s("h1",{id:"使用-okhttp-发送请求",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#使用-okhttp-发送请求","aria-hidden":"true"},"#"),a(" 使用 okhttp 发送请求")],-1),y={class:"table-of-contents"},d=r(`<h2 id="_1-添加依赖" tabindex="-1"><a class="header-anchor" href="#_1-添加依赖" aria-hidden="true">#</a> 1. 添加依赖</h2><p>在 <code>build.gradle</code> 中添加：</p><div class="language-properties" data-ext="properties"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">implementation(</span><span style="color:#CE9178;">&quot;com.squareup.okhttp3:okhttp:4.10.0&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="_2-基础设置" tabindex="-1"><a class="header-anchor" href="#_2-基础设置" aria-hidden="true">#</a> 2. 基础设置</h2><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">fun</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">setTimeoutAndCache</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> cacheDir = externalCacheDir</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> cacheSize = </span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">1024</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">1024L</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> okHttpClientBuilder = OkHttpClient.</span><span style="color:#DCDCAA;">Builder</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">connectTimeout</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, TimeUnit.SECONDS)</span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">readTimeout</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, TimeUnit.SECONDS)</span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">writeTimeout</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">20</span><span style="color:#D4D4D4;">, TimeUnit.SECONDS)</span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">cache</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">Cache</span><span style="color:#D4D4D4;">(</span><span style="color:#DCDCAA;">File</span><span style="color:#D4D4D4;">(cacheDir, </span><span style="color:#CE9178;">&quot;cache.txt&quot;</span><span style="color:#D4D4D4;">), cacheSize))</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> okHttpClient = okHttpClientBuilder.</span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-发起异步请求" tabindex="-1"><a class="header-anchor" href="#_2-发起异步请求" aria-hidden="true">#</a> 2. 发起异步请求</h2><h3 id="_2-1-基本-get-请求" tabindex="-1"><a class="header-anchor" href="#_2-1-基本-get-请求" aria-hidden="true">#</a> 2.1 基本 GET 请求</h3><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">fun</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">asyncGet</span><span style="color:#D4D4D4;">(url: </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> request = Request.</span><span style="color:#DCDCAA;">Builder</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">url</span><span style="color:#D4D4D4;">(url)</span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">method</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;GET&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">)    </span><span style="color:#6A9955;">// 也可以直接使用 .get() 方法 </span></span>
<span class="line"><span style="color:#D4D4D4;">        .</span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">OkHttpClient</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">newCall</span><span style="color:#D4D4D4;">(request).</span><span style="color:#DCDCAA;">enqueue</span><span style="color:#D4D4D4;">(object : </span><span style="color:#4EC9B0;">Callback</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">override</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">fun</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">onFailure</span><span style="color:#D4D4D4;">(call: </span><span style="color:#4EC9B0;">Call</span><span style="color:#D4D4D4;">, e: </span><span style="color:#4EC9B0;">IOException</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#6A9955;">// ...</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">override</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">fun</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">onResponse</span><span style="color:#D4D4D4;">(call: </span><span style="color:#4EC9B0;">Call</span><span style="color:#D4D4D4;">, response: </span><span style="color:#4EC9B0;">Response</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#6A9955;">// ...</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">    })</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-post-请求" tabindex="-1"><a class="header-anchor" href="#_2-2-post-请求" aria-hidden="true">#</a> 2.2 POST 请求</h3><p>创建请求方法：</p><div class="language-kotlin" data-ext="kt"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> requestBody = FormBody.</span><span style="color:#DCDCAA;">Builder</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;username&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;alex&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">add</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;password&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;pwdstring&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;"> </span></span>
<span class="line"><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> request = Request.</span><span style="color:#DCDCAA;">Builder</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">url</span><span style="color:#D4D4D4;">(url)</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">post</span><span style="color:#D4D4D4;">(requestBody)</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-3-post-发送文件" tabindex="-1"><a class="header-anchor" href="#_2-3-post-发送文件" aria-hidden="true">#</a> 2.3 POST 发送文件</h3><div class="language-kotlin" data-ext="kt"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> filePath = Environment.</span><span style="color:#DCDCAA;">getExternalStorageDirectory</span><span style="color:#D4D4D4;">().absolutePath</span></span>
<span class="line"><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> file = </span><span style="color:#DCDCAA;">File</span><span style="color:#D4D4D4;">(filePath, </span><span style="color:#CE9178;">&quot;test.txt&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> request = Request.</span><span style="color:#DCDCAA;">Builder</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">url</span><span style="color:#D4D4D4;">(url)</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">post</span><span style="color:#D4D4D4;">(file.</span><span style="color:#DCDCAA;">asRequestBody</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;text/txt; charset=utf-8&quot;</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toMediaType</span><span style="color:#D4D4D4;">()))</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-4-异步下载一个文件" tabindex="-1"><a class="header-anchor" href="#_2-4-异步下载一个文件" aria-hidden="true">#</a> 2.4 异步下载一个文件</h3><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">override</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">fun</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">onResponse</span><span style="color:#D4D4D4;">(call: </span><span style="color:#4EC9B0;">Call</span><span style="color:#D4D4D4;">, response: </span><span style="color:#4EC9B0;">Response</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> inputStream = response.body!!.</span><span style="color:#DCDCAA;">byteStream</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> filePath = Environment.</span><span style="color:#DCDCAA;">getExternalStorageDirectory</span><span style="color:#D4D4D4;">().absolutePath</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> file = </span><span style="color:#DCDCAA;">File</span><span style="color:#D4D4D4;">(filePath, </span><span style="color:#CE9178;">&quot;test.txt&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> fileOutputStream = </span><span style="color:#DCDCAA;">FileOutputStream</span><span style="color:#D4D4D4;">(file)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> buffer = </span><span style="color:#DCDCAA;">ByteArray</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">2048</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">do</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> len = inputStream.</span><span style="color:#DCDCAA;">read</span><span style="color:#D4D4D4;">(buffer)</span></span>
<span class="line"><span style="color:#D4D4D4;">        fileOutputStream.</span><span style="color:#DCDCAA;">write</span><span style="color:#D4D4D4;">(buffer, </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, len)</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">while</span><span style="color:#D4D4D4;"> (len! = -</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    fileOutputStream.</span><span style="color:#DCDCAA;">flush</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-异步上传-multipart-文件" tabindex="-1"><a class="header-anchor" href="#_2-5-异步上传-multipart-文件" aria-hidden="true">#</a> 2.5 异步上传 Multipart 文件</h3><div class="language-kotlin" data-ext="kt"><pre class="shiki dark-plus" style="background-color:#1E1E1E;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">val</span><span style="color:#D4D4D4;"> requestBody = MultipartBody.</span><span style="color:#DCDCAA;">Builder</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">setType</span><span style="color:#D4D4D4;">(MultipartBody.FORM)</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">addFormDataPart</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;title&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;img&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">addFormDataPart</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;image&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;test.png&quot;</span><span style="color:#D4D4D4;">, RequestBody.</span><span style="color:#DCDCAA;">create</span><span style="color:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#CE9178;">&quot;image/png&quot;</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toMediaType</span><span style="color:#D4D4D4;">(), </span><span style="color:#DCDCAA;">File</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/sdcard/test.png&quot;</span><span style="color:#D4D4D4;">)))</span></span>
<span class="line"><span style="color:#D4D4D4;">    .</span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"></span></code></pre></div>`,17);function u(C,v){const n=o("router-link");return D(),t("div",null,[i,s("nav",y,[s("ul",null,[s("li",null,[l(n,{to:"#_1-添加依赖"},{default:p(()=>[a("1. 添加依赖")]),_:1})]),s("li",null,[l(n,{to:"#_2-基础设置"},{default:p(()=>[a("2. 基础设置")]),_:1})]),s("li",null,[l(n,{to:"#_2-发起异步请求"},{default:p(()=>[a("2. 发起异步请求")]),_:1}),s("ul",null,[s("li",null,[l(n,{to:"#_2-1-基本-get-请求"},{default:p(()=>[a("2.1 基本 GET 请求")]),_:1})]),s("li",null,[l(n,{to:"#_2-2-post-请求"},{default:p(()=>[a("2.2 POST 请求")]),_:1})]),s("li",null,[l(n,{to:"#_2-3-post-发送文件"},{default:p(()=>[a("2.3 POST 发送文件")]),_:1})]),s("li",null,[l(n,{to:"#_2-4-异步下载一个文件"},{default:p(()=>[a("2.4 异步下载一个文件")]),_:1})]),s("li",null,[l(n,{to:"#_2-5-异步上传-multipart-文件"},{default:p(()=>[a("2.5 异步上传 Multipart 文件")]),_:1})])])])])]),d])}const h=e(c,[["render",u],["__file","use-okhttp.html.vue"]]);export{h as default};
